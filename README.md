# 🚀 Cloudflare 私人专属临时邮箱 (小白科普与保姆级教程)

这是一个运行在 Cloudflare 上的极简临时邮箱系统。无需购买服务器，永久免费！
它不仅解决了市面上同类项目的痛点（**乱码问题**、**免费额度消耗快**、**隐私泄露**），更是一个带你入门 **Serverless（无服务器架构）** 的绝佳实践项目。

无论你是技术大牛还是纯小白，只要跟着这篇教程，10 分钟就能拥有属于你的私人收信神器，并彻底弄懂它背后的运行逻辑。

---

## 🧠 核心概念：什么是 Worker？我们为什么不需要买服务器？



[Image of Serverless computing architecture]


在过去，建网站或收邮件必须“租服务器”（就像租个门面），哪怕没人访问，你也要24小时付租金。
现在的“黑科技”叫 **Cloudflare Worker**。它就像一个“住在网线里的临时工”：
- **按需唤醒**：平时它不存在（不耗源、不花钱）。只有当“信件到达”或“你刷新网页”的那一瞬间，它才会被瞬间唤醒。
- **即用即走**：干完活（处理完邮件或生成好网页），几毫秒后它就自动消失了。
这就是为什么这个项目能做到**零成本、免维护**的原因。

---

## ✨ 项目核心特性

1. **💰 极致省钱逻辑**：摒弃后台自动刷新，改为**手动刷新按钮**，绝不浪费 Cloudflare 的免费读取额度。
2. **🖼️ 原版排版还原**：内置深度 MIME 解析引擎，完美显示带图片、按钮、CSS 颜色的注册确认邮件。
3. **🗑️ 物理彻底删除**：一键“彻底清空”，直接从数据库底层物理抹除数据，保障隐私并释放空间。

---

## 🛠️ 从零开始的部署教程 (附带原理解析)

### 🔴 第一步：让 Cloudflare 接管你的域名 (最关键的一步)
*前提：你需要拥有一个自己的域名（去阿里云、腾讯云、Namesilo 等平台购买即可）。*

1. 注册并登录 [Cloudflare 官网](https://dash.cloudflare.com/)。
2. 点击 **“Add a site”** (添加站点)，输入你的域名，选择 **Free (免费版)** 计划。
3. **修改 DNS 服务器 (Nameservers)** —— *⚠️ 高频踩坑预警*：
   Cloudflare 会给你分配两个地址（类似 `bob.ns.cloudflare.com` 和 `lola.ns.cloudflare.com`）。你需要做的是**“移交管理权”**，而不是简单的添加记录。

   - **去哪里改？** 登录你**买域名的平台**（如阿里云、腾讯云、Godaddy）。
   - **找什么按钮？** 找到“域名管理”列表，点击你的域名，寻找 **“修改 DNS 服务器”**、**“DNS 修改”** 或 **“自定义 DNS”**。
   - **怎么改？** 选择“自定义”，**删掉**原本自带的那几行旧地址，**填入** Cloudflare 给你的那两个新地址。
   
   > **🚫 常见错误 (千万别做)：**
   > 不要去旧平台的“DNS 解析设置”里添加 `NS` 记录，那样没用！你必须在**域名注册商**的底层设置里，把整个域名的“管家”换成 Cloudflare。

   - **改完没反应？** 别慌！全球 DNS 刷新需要时间。
     - 快则 10 分钟，慢则 24 小时。
     - 你可以去喝杯咖啡，偶尔回 Cloudflare 首页点一下 **"Check nameservers"** 按钮。
     - 当状态变成绿色的 **Active (已激活)**，才算成功。

> **💡 原理科普：为什么要改 DNS？**
> 域名就像你的**“房产”**，DNS 服务器是你的**“物业管家”**。
> 默认情况下，你买房（域名）时开发商（阿里云）会送你一个物业。但那个物业太笨了，不支持我们需要的 Worker 功能。
> 所以这一步的操作，本质上是**炒掉开发商的物业，聘请 Cloudflare 来当你的新管家**。只有这样，所有发往你房子的信件（邮件）和访客（网页访问），才会先经过 Cloudflare 的大门，我们的代码才能帮你收信。

### 🟡 第二步：创建数据仓库 (KV)
我们需要一个地方来临时存放你的邮件。

1. **找不到入口？** Cloudflare 菜单非常多，最快的方法是：
   - 在页面左上角（或顶部）的 **搜索框 (Search)** 里输入：`Workers`。
   - 点击搜索结果中的 **Workers & Pages**。
2. 进入后，在左侧子菜单找到 **KV**。
3. 点击右上角的 **Create Namespace** (创建命名空间)。
4. **Namespace Name** 随便填一个（比如 `TEMP_MAIL`），点击 **Add**。

> **💡 原理科普：什么是 KV 数据库？**
> Worker 这个临时工干完活就消失了，没有记忆。KV (Key-Value) 就像是 Cloudflare 提供的一个**“公共记事本”**。Worker 收到邮件后把它写在记事本上；等你打开网页时，另一个 Worker 再去记事本上把邮件内容抄下来展示给你。

### 🟢 第三步：部署 Worker 核心代码
1. 依然是在 **Workers & Pages** 页面，点击 **Overview** (概览)。
2. 点击右侧的 **Create Application** -> **Create Worker**。
3. 名字随便起（如 `temp-mail-worker`），点击 **Deploy** (先部署一个空壳)。
4. 点击 **Edit code** (编辑代码)。
5. 清空左侧的大黑框，将本项目中的 `index.js` 代码**全部复制粘贴**进去。
6. **⚠️ 必须修改的配置**：
   - 找到代码第 71 行左右的这一句：`const myDomain = env.DOMAIN || 'yourdomain.com';`
   - 将里面的 `'yourdomain.com'` 替换成你自己的真实域名！
7. 点击右上角的蓝色按钮 **Deploy** 保存。

> **💡 原理科普：这份代码在干嘛？**
> 这份 `index.js` 代码就是一张**“全能工单”**。它包含了两部分指令：第一部分教 Worker 收到邮件时怎么拆开乱码存进 KV；第二部分教 Worker 有人访问网页时，怎么去 KV 里拿数据并画成一个漂亮的网页。
### 🔵 第四步：给 Worker 配发“记事本钥匙” (绑定 KV)
1. 退出代码编辑器，回到 Worker 的详情页面，点击顶部的 **Settings** (设置)。
2. 左侧找到 **Variables** (变量和机密)。
3. 向下滚动找到 **KV Namespace Bindings**，点击 **Add binding**：
   - **Variable name** 填入：`KV` (必须全大写，代码里写死了认这个词)。
   - **KV namespace** 选择：你在第二步创建的那个 `TEMP_MAIL` 记事本。
4. **保存后，请重新 Deploy 一次 Worker 使其生效。**
> **💡 原理科普：为什么要绑定？**
> 出于安全考虑，Worker 默认是碰不到你的 KV 记事本的。这一步就是给你的代码发一把名为 `KV` 的钥匙，允许它对这个记事本进行读写。不绑定的后果就是网页报错打不开。

### 🟣 第五步：设置邮件路由 (拦截邮件)



1. 在 Cloudflare 面板左侧，点击返回你的**域名主页**。
2. 找到 **Email** -> **Email Routing** (电子邮件路由)。按提示一路点击配置开启。
3. 点击 **Routing rules** (路由规则) 标签页。
4. 找到 **Catch-all address** (捕获所有地址)：
   - 开启它，**Action** 选择：**Send to a Worker** (发送到 Worker)。
   - **Destination** 选择：你在第三步创建的 Worker 名字。
   - 点击 **Save**。
> **💡 原理科普：什么是 Catch-all (捕获所有)？**
> 别人无论给你发 `abc@你的域名` 还是 `123@你的域名`，正常情况下没有建立的邮箱会直接拒收退信。Catch-all 就像一个大漏斗，把所有只要后缀是你域名的信件全部没收，并直接扔给你的 Worker 处理。这就是为什么你能随时生成无数个随机前缀地址的原因。

🎉 **大功告成！现在你可以访问你的 Worker 域名来接收邮件了！**

---

## 避坑指南 (FAQ & 高级技巧)

### 1. 怎么给网页换一个更隐蔽的访问地址？
Cloudflare 默认分配的 `*.workers.dev` 域名容易被墙，且不够个性。
- 进入你的 Worker 详情页 -> **Settings**。
- 找到 **Triggers** (触发器) 或者 **Domains & Routes**。
- 找到 **Custom Domains** (自定义域) -> **Add Custom Domain**。
- 输入你想要的前缀，比如 `secretbox.yourdomain.com`。以后你就可以直接用这个隐蔽的网址打开网页了！

### 2. 挂着代理/VPN 访问网页时报错 "Relay failed"？
这是因为某些代理软件（如 Geph 迷雾通）无法正确处理 Cloudflare 的节点。
- **解决方案**：在浏览器代理插件（如 SwitchyOmega）中，将你的网页域名设置为 **Direct (直接连接)** 即可。

---

## 📜 许可证
本项目采用 [MIT License](LICENSE) 协议开源。欢迎 Fork 并自由修改使用！
